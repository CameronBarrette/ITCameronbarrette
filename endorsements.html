<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBksnr8qDgjAhwPQSK73M10doQwHPU6aoc",
  authDomain: "portfolio-cb9aa.firebaseapp.com",
  projectId: "portfolio-cb9aa",
  storageBucket: "portfolio-cb9aa.firebasestorage.app",
  messagingSenderId: "1005509574520",
  appId: "1:1005509574520:web:285a432471025fa506128d",
  measurementId: "G-6SX1C69ZEW"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Sign user in anonymously (gives them a UID)
await signInAnonymously(auth);

window.addComment = async function () {
    const name = document.getElementById("name").value;
    const contact = document.getElementById("contact").value;
    const comment = document.getElementById("comment").value;

    await addDoc(collection(db, "endorsements"), {
        name,
        contact,
        comment,
        uid: auth.currentUser.uid
    });

    location.reload();
};

async function loadComments() {
    const querySnapshot = await getDocs(collection(db, "endorsements"));
    const commentsDiv = document.getElementById("comments");

    querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();

        const div = document.createElement("div");
        div.className = "comment-card";

        // Only show delete button if THIS user owns the comment
        let deleteButton = "";
        if (data.uid === auth.currentUser.uid) {
            deleteButton = `<button onclick="deleteComment('${docSnap.id}')" class="download-btn">Delete</button>`;
        }

        div.innerHTML = `
            <strong>${data.name}</strong><br>
            ${data.comment}<br>
            <em>${data.contact || ""}</em><br><br>
            ${deleteButton}
        `;

        commentsDiv.appendChild(div);
    });
}

window.deleteComment = async function (id) {
    await deleteDoc(doc(db, "endorsements", id));
    location.reload();
};

loadComments();
</script>
