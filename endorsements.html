<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Endorsements | Cameron Barrette</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
</head>

<body>

<!-- DARK MODE POPUP -->
<div id="overlay" class="dark-overlay">
    <div class="dark-popup">
        <h3>Enable Dark Mode?</h3>
        <button onclick="setDark(true)">Yes</button>
        <button onclick="setDark(false)">No</button>
    </div>
</div>

<header class="top-banner">
    <div class="left">
        <img src="me.jpg.webp" alt="Cameron Barrette" class="profile-pic">
    </div>
    <div class="center">Cameron Barrette | IT & CyberSecurity</div>
    <div class="right">
        <a href="https://www.linkedin.com/in/cameron-barrette-it/" target="_blank" class="top-link">
            LinkedIn
        </a>
    </div>
</header>

<div class="main-layout">

<nav class="sidebar">
    <a href="index.html">Home</a>
    <a href="about.html">About Me</a>
    <a href="projects.html">Projects</a>
    <a href="certifications.html">Certifications</a>
    <a href="resume.html">Resume</a>
    <a href="endorsements.html">Endorsements</a>
    <a href="contact.html">Contact</a>
</nav>

<div class="content">

    <h1>Leave an Endorsement</h1>

    <div class="endorsement-form">
        <input id="name" placeholder="Your Name">
        <input id="contact" placeholder="Email or Phone (optional)">
        <textarea id="comment" placeholder="Your endorsement"></textarea>
        <button id="submitBtn" class="download-btn">Submit</button>
    </div>

    <hr><br>

    <h2>What People Are Saying</h2>
    <div id="comments"></div>

</div>
</div>

<!-- DARK MODE SCRIPT (ONLY ONE) -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const overlay = document.getElementById("overlay");
    const chosen = localStorage.getItem("darkModeChosen");
    const dark = localStorage.getItem("darkMode");

    if (dark === "true") {
        document.body.classList.add("dark-mode");
    }

    if (!chosen) {
        overlay.style.display = "flex";
        document.querySelector(".main-layout").classList.add("blur");
        document.querySelector(".top-banner").classList.add("blur");
    }

    window.setDark = function(choice) {
        localStorage.setItem("darkModeChosen", "true");

        if (choice) {
            document.body.classList.add("dark-mode");
            localStorage.setItem("darkMode", "true");
        } else {
            localStorage.setItem("darkMode", "false");
        }

        overlay.style.display = "none";
        document.querySelector(".main-layout").classList.remove("blur");
        document.querySelector(".top-banner").classList.remove("blur");
    };

});
</script>

<!-- YOUR FIREBASE (unchanged) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSy...",
  authDomain: "portfolio-cb9aa.firebaseapp.com",
  projectId: "portfolio-cb9aa",
  storageBucket: "portfolio-cb9aa.firebasestorage.app",
  messagingSenderId: "1005509574520",
  appId: "1:1005509574520:web:285a432471025fa506128d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let currentUID = null;

async function init() {
    await signInAnonymously(auth);
    currentUID = auth.currentUser.uid;
    loadComments();
}

document.getElementById("submitBtn").addEventListener("click", async () => {
    const name = document.getElementById("name").value;
    const contact = document.getElementById("contact").value;
    const comment = document.getElementById("comment").value;

    if (!name || !comment) {
        alert("Please enter your name and comment");
        return;
    }

    await addDoc(collection(db, "endorsements"), {
        name,
        contact,
        comment,
        uid: currentUID
    });

    location.reload();
});

async function loadComments() {
    const querySnapshot = await getDocs(collection(db, "endorsements"));
    const commentsDiv = document.getElementById("comments");
    commentsDiv.innerHTML = "";

    querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();

        const div = document.createElement("div");
        div.className = "comment-card";

        let deleteButton = "";
        if (data.uid === currentUID) {
            deleteButton = `<button onclick="deleteComment('${docSnap.id}')" class="download-btn">Delete</button>`;
        }

        div.innerHTML = `
            <strong>${data.name}</strong><br>
            ${data.comment}<br>
            <em>${data.contact || ""}</em><br><br>
            ${deleteButton}
        `;

        commentsDiv.appendChild(div);
    });
}

window.deleteComment = async function (id) {
    await deleteDoc(doc(db, "endorsements", id));
    location.reload();
};

init();
</script>

</body>
</html>
