<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Endorsements | Cameron Barrette</title>
<link rel="stylesheet" href="./style.css">
</head>

<body>

<div class="content">
    <h1>Leave an Endorsement</h1>

    <input id="name" placeholder="Your Name">
    <input id="contact" placeholder="Email or Phone (optional)">
    <textarea id="comment" placeholder="Your endorsement"></textarea>
    <button id="submitBtn">Submit</button>

    <h2>What People Are Saying</h2>
    <div id="comments"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBksnr8qDgjAhwPQSK73M10doQwHPU6aoc",
  authDomain: "portfolio-cb9aa.firebaseapp.com",
  projectId: "portfolio-cb9aa",
  storageBucket: "portfolio-cb9aa.firebasestorage.app",
  messagingSenderId: "1005509574520",
  appId: "1:1005509574520:web:285a432471025fa506128d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let currentUID = null;

async function init() {
    await signInAnonymously(auth);
    currentUID = auth.currentUser.uid;
    loadComments();
}

document.getElementById("submitBtn").addEventListener("click", async () => {
    const name = name.value;
    const contact = contact.value;
    const comment = comment.value;

    await addDoc(collection(db, "endorsements"), {
        name,
        contact,
        comment,
        uid: currentUID
    });

    location.reload();
});

async function loadComments() {
    const snapshot = await getDocs(collection(db, "endorsements"));
    const div = document.getElementById("comments");
    div.innerHTML = "";

    snapshot.forEach((d) => {
        const data = d.data();

        const card = document.createElement("div");
        card.innerHTML = `
            <strong>${data.name}</strong><br>
            ${data.comment}<br>
            <em>${data.contact || ""}</em><br><br>
            ${data.uid === currentUID ? `<button onclick="deleteComment('${d.id}')">Delete</button>` : ""}
            <hr>
        `;
        div.appendChild(card);
    });
}

window.deleteComment = async function(id) {
    await deleteDoc(doc(db, "endorsements", id));
    location.reload();
};

init();
</script>

</body>
</html>
